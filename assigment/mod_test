// --------------------
// UNHAPPY PATHS
// --------------------

test.serial('Books: GET unknown id -> 404', async (t) => {
  await t.context.client
    .get('/books/999999')
    .set('Accept', 'application/json')
    .expect(404);
});

test.serial('Books: PUT unknown id -> 404', async (t) => {
  await t.context.client
    .put('/books/999999')
    .set('Content-Type', 'application/json')
    .send({ published_year: 1900 })
    .expect(404);
});

test.serial('Books: DELETE unknown id -> 404', async (t) => {
  await t.context.client
    .delete('/books/999999')
    .expect(404);
});

test.serial('Books: non-numeric id -> 400', async (t) => {
  await t.context.client
    .get('/books/not-a-number')
    .set('Accept', 'application/json')
    .expect(400);
});

test.serial('Books: after DELETE, GET same id -> 404', async (t) => {
  const created = await t.context.client
    .post('/books')
    .set('Content-Type', 'application/json')
    .send({ title: 'Temp', author_id: 1, category_id: 1, published_year: 2000 })
    .expect(201);

  const bookId = created.body.id;

  await t.context.client
    .delete(`/books/${bookId}`)
    .expect(204);

  await t.context.client
    .get(`/books/${bookId}`)
    .set('Accept', 'application/json')
    .expect(404);
});


test.serial('Authors: GET unknown id -> 404', async (t) => {
  await t.context.client
    .get('/authors/999999')
    .set('Accept', 'application/json')
    .expect(404);
});

test.serial('Authors: PUT unknown id -> 404', async (t) => {
  await t.context.client
    .put('/authors/999999')
    .set('Content-Type', 'application/json')
    .send({ name: 'Nobody' })
    .expect(404);
});

test.serial('Authors: DELETE unknown id -> 404', async (t) => {
  await t.context.client
    .delete('/authors/999999')
    .expect(404);
});

test.serial('Authors: non-numeric id -> 400', async (t) => {
  await t.context.client
    .get('/authors/abc')
    .set('Accept', 'application/json')
    .expect(400);
});

test.serial('Authors: after DELETE, GET same id -> 404', async (t) => {
  const created = await t.context.client
    .post('/authors')
    .set('Content-Type', 'application/json')
    .send({ name: 'Temp Author' })
    .expect(201);

  const authorId = created.body.id;

  await t.context.client
    .delete(`/authors/${authorId}`)
    .expect(204);

  await t.context.client
    .get(`/authors/${authorId}`)
    .set('Accept', 'application/json')
    .expect(404);
});


test.serial('Categories: GET unknown id -> 404', async (t) => {
  await t.context.client
    .get('/categories/999999')
    .set('Accept', 'application/json')
    .expect(404);
});

test.serial('Categories: PUT unknown id -> 404', async (t) => {
  await t.context.client
    .put('/categories/999999')
    .set('Content-Type', 'application/json')
    .send({ name: 'Nope' })
    .expect(404);
});

test.serial('Categories: DELETE unknown id -> 404', async (t) => {
  await t.context.client
    .delete('/categories/999999')
    .expect(404);
});

test.serial('Categories: non-numeric id -> 400', async (t) => {
  await t.context.client
    .get('/categories/xyz')
    .set('Accept', 'application/json')
    .expect(400);
});

test.serial('Categories: after DELETE, GET same id -> 404', async (t) => {
  const created = await t.context.client
    .post('/categories')
    .set('Content-Type', 'application/json')
    .send({ name: 'Temp Category' })
    .expect(201);

  const categoryId = created.body.id;

  await t.context.client
    .delete(`/categories/${categoryId}`)
    .expect(204);

  await t.context.client
    .get(`/categories/${categoryId}`)
    .set('Accept', 'application/json')
    .expect(404);
});
