'use strict';

var utils = require('../utils/writer.js');
var Default = require('../service/DefaultService');

// Small helper: write success response with optional status
function ok(res, payload, status) {
  utils.writeJson(res, payload, status);
}

// Small helper: normalize errors coming from service
function fail(res, err) {
  // If service rejects with {status, message, ...}, respect it.
  const status = (err && err.status) ? err.status : 500;
  ok(res, err, status);
}

// If a service returns undefined/null for resource endpoints, treat as 404
function notFound(res, entityName) {
  ok(res, { status: 404, message: `${entityName} not found` }, 404);
}

/**
 * AUTHORS
 */
module.exports.authorsAuthorIdDELETE = function authorsAuthorIdDELETE(req, res, next, authorId) {
  Default.authorsAuthorIdDELETE(authorId)
    .then(function () {
      // 204 No Content
      res.status(204).end();
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.authorsAuthorIdGET = function authorsAuthorIdGET(req, res, next, authorId) {
  Default.authorsAuthorIdGET(authorId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Author');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.authorsAuthorIdPUT = function authorsAuthorIdPUT(req, res, next, body, authorId) {
  Default.authorsAuthorIdPUT(body, authorId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Author');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.authorsGET = function authorsGET(req, res, next) {
  Default.authorsGET()
    .then(function (response) {
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.authorsPOST = function authorsPOST(req, res, next, body) {
  Default.authorsPOST(body)
    .then(function (response) {
      ok(res, response, 201);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

/**
 * BOOKS
 */
module.exports.booksBookIdDELETE = function booksBookIdDELETE(req, res, next, bookId) {
  Default.booksBookIdDELETE(bookId)
    .then(function () {
      res.status(204).end();
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.booksBookIdGET = function booksBookIdGET(req, res, next, bookId) {
  Default.booksBookIdGET(bookId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Book');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.booksBookIdPUT = function booksBookIdPUT(req, res, next, body, bookId) {
  Default.booksBookIdPUT(body, bookId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Book');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.booksGET = function booksGET(req, res, next) {
  Default.booksGET()
    .then(function (response) {
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.booksPOST = function booksPOST(req, res, next, body) {
  Default.booksPOST(body)
    .then(function (response) {
      ok(res, response, 201);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

/**
 * CATEGORIES
 */
module.exports.categoriesCategoryIdDELETE = function categoriesCategoryIdDELETE(req, res, next, categoryId) {
  Default.categoriesCategoryIdDELETE(categoryId)
    .then(function () {
      res.status(204).end();
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.categoriesCategoryIdGET = function categoriesCategoryIdGET(req, res, next, categoryId) {
  Default.categoriesCategoryIdGET(categoryId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Category');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.categoriesCategoryIdPUT = function categoriesCategoryIdPUT(req, res, next, body, categoryId) {
  Default.categoriesCategoryIdPUT(body, categoryId)
    .then(function (response) {
      if (response == null) return notFound(res, 'Category');
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.categoriesGET = function categoriesGET(req, res, next) {
  Default.categoriesGET()
    .then(function (response) {
      ok(res, response, 200);
    })
    .catch(function (err) {
      fail(res, err);
    });
};

module.exports.categoriesPOST = function categoriesPOST(req, res, next, body) {
  Default.categoriesPOST(body)
    .then(function (response) {
      ok(res, response, 201);
    })
    .catch(function (err) {
      fail(res, err);
    });
};
